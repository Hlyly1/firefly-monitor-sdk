# 项目初始化指南

## 环境要求

- Node.js >= 16.x
- npm >= 8.x 或 yarn >= 1.22.x 或 pnpm >= 8.x
- Git >= 2.x

## 初始化步骤

### 1. 安装依赖

在项目根目录运行：

```bash
npm install
```

或使用 yarn：

```bash
yarn install
```

或使用 pnpm：

```bash
pnpm install
```

### 2. 初始化 Git（如未初始化）

```bash
git init
```

### 3. 初始化 Husky（Git Hooks）

安装依赖后，会自动执行 `husky install`，如果没有自动执行，手动运行：

```bash
npm run prepare
```

然后创建 Git hooks：

```bash
# 创建 pre-commit hook
npx husky add .husky/pre-commit "npx lint-staged"

# 创建 commit-msg hook
npx husky add .husky/commit-msg "npx --no -- commitlint --edit $1"
```

### 4. 验证配置

#### 检查 TypeScript 配置

```bash
npm run type-check
```

#### 检查代码规范

```bash
npm run lint
```

#### 检查代码格式

```bash
npm run format:check
```

#### 运行测试

```bash
npm test
```

#### 构建项目

```bash
npm run build
```

## 开发流程

### 开发模式

启动开发模式（watch 模式）：

```bash
npm run dev
```

### 提交代码

使用 commitizen 进行规范化提交：

```bash
npm run commit
```

或直接使用 git commit（需遵循 Conventional Commits 规范）：

```bash
git commit -m "feat: 添加新功能"
```

### Commit 类型说明

- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档变更
- `style`: 代码格式（不影响代码运行）
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试相关
- `build`: 构建系统或依赖变更
- `ci`: CI 配置变更
- `chore`: 其他杂项

### 版本发布

```bash
# 自动升级版本并生成 CHANGELOG
npm run release

# 指定版本类型
npm run release:minor  # 0.1.0 -> 0.2.0
npm run release:major  # 0.1.0 -> 1.0.0

# 推送到远程仓库
git push --follow-tags origin main

# 发布到 npm
npm publish
```

## 常见问题

### Q1: 安装依赖失败

尝试清理缓存后重新安装：

```bash
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### Q2: Husky hooks 不生效

确保已运行：

```bash
npm run prepare
```

并检查 `.husky` 目录下的脚本文件是否有执行权限。

### Q3: ESLint 报错

检查 `.eslintrc.js` 配置，确保项目依赖已安装：

```bash
npm install -D @typescript-eslint/eslint-plugin @typescript-eslint/parser
```

### Q4: TypeScript 编译错误

确保 `tsconfig.json` 配置正确，并且所有类型依赖已安装。

## 目录结构说明

```
d:\_firefly/
├── src/                    # 源码目录
│   ├── core/              # 核心模块
│   ├── performance/       # 性能监控
│   ├── error/             # 错误监控
│   ├── behavior/          # 行为监控
│   ├── reporter/          # 数据上报
│   ├── utils/             # 工具函数
│   ├── plugins/           # 插件系统
│   └── index.ts           # 入口文件
├── tests/                 # 测试目录
│   ├── unit/             # 单元测试
│   └── e2e/              # E2E测试
├── examples/              # 示例项目
├── docs/                  # 文档
├── scripts/               # 构建脚本
├── .github/              # GitHub配置
└── dist/                 # 构建产物（自动生成）
```

## 下一步

1. 完善核心功能模块
2. 编写单元测试
3. 完善文档
4. 添加示例项目

## 参考资源

- [TypeScript 官方文档](https://www.typescriptlang.org/)
- [ESLint 配置指南](https://eslint.org/docs/user-guide/configuring)
- [Conventional Commits](https://www.conventionalcommits.org/)
- [Husky 使用指南](https://typicode.github.io/husky/)
